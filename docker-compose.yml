services:
  ai-video-app:
    build: .
    container_name: ocr_testing_container
    
    # 1. GPU RESERVATION: This allows the container to use your RTX 4060
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]

    ports:
      - "5003:5003"
    
    volumes:
      - .:/app
      # 2. PERSISTENT MODELS: Saves EasyOCR models on your host so they don't 
      # re-download or get corrupted easily.
      - ~/.EasyOCR:/root/.EasyOCR

    environment:
      - PYTHONUNBUFFERED=1
      # 3. CUDA SETTINGS: Ensures the app knows to look for the GPU
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=compute,utility,video
    
    stdin_open: true
    tty: true
    restart: unless-stopped